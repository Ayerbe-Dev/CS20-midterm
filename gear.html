<!DOCTYPE html>
<html>
<head>
    <title>Gear - CS20 Midterm</title>
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript" src="cart.js"></script>
    <script 
      src="https://code.jquery.com/jquery-3.1.1.min.js" 
      integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" 
      crossorigin="anonymous">
    </script>
</head>
<body>
  <header>
    <h1>Green Mountain Outfitters</h1>
    <nav>
       <a href="index.html">Home</a>
       <a href="gear.html">Gear</a>
       <a href="history.html">History</a>
       <a href="cart.html">Cart</a>
    </nav>
  </header>

  <main>
    <div id="gear-container">
      <!-- Products will be inserted here dynamically -->
    </div>
  </main>

  <footer>
    <p>&copy; 2025 CS20 Midterm Project</p>
  </footer>
  <script language = "javascript">
    // Render the gear items dynamically in the #gear-container div
    function populateGear() {
      const container = document.getElementById('gear-container');
      const cartNameString = localStorage.getItem('cartNames');
      const cartNames = cartNameString ? JSON.parse(cartNameString) : [];
      const cartNumString = localStorage.getItem('cartNums');
      const cartNums = cartNumString ? JSON.parse(cartNumString) : [];
      $.get("https://raw.githubusercontent.com/Ayerbe-Dev/CS20-midterm/master/gear.json", 
        function(data) {
          data = JSON.parse(data); //???
          str = "";
          data["gear"].forEach(function(gear) {
            str += "<div class = 'product' id = '" + gear.name + "'>";
              str += "<img alt = " + gear.name + "/>";
              str += "<h2>" + gear.name + "</h2>";
              str += "<p>" + gear.desc + "</p>";
              str += "<p>$" + gear.price + "</p>";
              
              str += "<div id = '" + gear.name + "_cartinfo'>"
              let idx = cartNames.indexOf(gear.name)
              if (idx != -1) { 
                //If the item is already in the cart, we use up and down arrows to change the quantity
                //of items instead of just adding it to the cart

                //TODO:
                //- Make it so which set of buttons you can see changes dynamically instead of
                //  only when you refresh the page
                str += "<button onclick = 'incGearCartNum(\"" + gear.name + "\")'>&nbsp;&uarr;&nbsp;</button>";
                str += "<h2 id = '" + gear.name + "_cartquant'>" + cartNums[idx] + "</h2>";
                str += "<button onclick = 'decGearCartNum(\"" + gear.name + "\")'>&nbsp;&darr;&nbsp;</button>";
              }
              else {
                str += "<button onclick = 'addGearToCart(\"" + gear.name + "\")'>Add to Cart</button>";
              }
              str += "</div>";
            str += "</div>";
          });
          container.innerHTML = str;
        })
    }

    function addGearToCart(name) {
      addToCart(name, 1);
      str = "<button onclick = 'incGearCartNum(\"" + name + "\")'>&nbsp;&uarr;&nbsp;</button>\
            <h2 id = '" + name + "_cartquant'>1</h2>\
            <button onclick = 'decGearCartNum(\"" + name + "\")'>&nbsp;&darr;&nbsp;</button>";
      document.getElementById(name + "_cartinfo").innerHTML = str;
    }

    function incGearCartNum(name) {
      incCartNum(name);
      document.getElementById(name + "_cartquant").innerText = getNumItemsInCart(name);
    }

    function decGearCartNum(name) {
      decCartNum(name);
      num = getNumItemsInCart(name);      
      if (num) {
        document.getElementById(name + "_cartquant").innerText = num;
      }
      else {
        document.getElementById(name + "_cartinfo").innerHTML = "<button onclick = 'addGearToCart(\"" + name + "\")'>Add to Cart</button>";
      }
    }

    document.addEventListener('DOMContentLoaded', populateGear);
  </script>
</body>
</html>
